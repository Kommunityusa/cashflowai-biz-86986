<!DOCTYPE html>
<html>
<head>
    <title>Generate Blog Post</title>
    <meta charset="UTF-8">
    <style>
        body { 
            font-family: system-ui; 
            max-width: 800px; 
            margin: 40px auto; 
            padding: 20px;
            background: #f3f4f6;
        }
        .card { 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 { color: #1f2937; margin-bottom: 20px; }
        button {
            background: #22c55e;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover { background: #16a34a; }
        button:disabled { background: #9ca3af; cursor: not-allowed; }
        #result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }
        .success { background: #d1fae5; border: 2px solid #10b981; display: block; }
        .error { background: #fee2e2; border: 2px solid #ef4444; display: block; }
        .loading { background: #dbeafe; border: 2px solid #3b82f6; display: block; }
        pre { 
            background: #1f2937; 
            color: #f3f4f6; 
            padding: 15px; 
            border-radius: 6px; 
            overflow-x: auto;
            font-size: 13px;
        }
        a { 
            display: inline-block;
            margin: 10px 5px;
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 6px;
        }
        a:hover { background: #2563eb; }
    </style>
</head>
<body>
    <div class="card">
        <h1>üöÄ Generate Blog Post</h1>
        <p>Click the button below to generate and publish a new AI-powered blog post.</p>
        <button id="genBtn" onclick="generateBlog()">Generate Blog Post Now</button>
        <div id="result"></div>
    </div>

    <script>
        async function generateBlog() {
            const btn = document.getElementById('genBtn');
            const result = document.getElementById('result');
            
            btn.disabled = true;
            result.className = 'loading';
            result.innerHTML = '<p><strong>‚è≥ Generating blog post...</strong></p><p>This takes 30-60 seconds. Please wait...</p>';

            try {
                const response = await fetch('https://awszwetvzugirgacpcem.supabase.co/functions/v1/test-blog-insert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3c3p3ZXR2enVnaXJnYWNwY2VtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MDQ1MjQsImV4cCI6MjA3NTQ4MDUyNH0.-0ToTDxMYjEfwAmVzcnCku5KbkjZdsemGbviGzXEdrI'
                    },
                    body: JSON.stringify({})
                });

                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Failed to generate blog');
                }

                result.className = 'success';
                result.innerHTML = `
                    <h2>‚úÖ Success!</h2>
                    <p><strong>${data.message}</strong></p>
                    ${data.testPost ? `
                        <h3>Test Post Created:</h3>
                        <p><strong>Title:</strong> ${data.testPost.title}</p>
                        <p><strong>Slug:</strong> ${data.testPost.slug}</p>
                    ` : ''}
                    ${data.generatedPost ? `
                        <h3>Generated Post:</h3>
                        <p><strong>Title:</strong> ${data.generatedPost.title}</p>
                        <p><strong>Category:</strong> ${data.generatedPost.category}</p>
                        <p><strong>Excerpt:</strong> ${data.generatedPost.excerpt}</p>
                        <a href="/blog/${data.generatedPost.slug}">Read Post</a>
                    ` : ''}
                    <a href="/blog">View All Blog Posts</a>
                    <details style="margin-top: 20px;">
                        <summary>View Full Response</summary>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </details>
                `;
                btn.disabled = false;

            } catch (error) {
                result.className = 'error';
                result.innerHTML = `
                    <h2>‚ùå Error</h2>
                    <p><strong>${error.message}</strong></p>
                    <p>Check the browser console for more details.</p>
                    <button onclick="location.reload()">Try Again</button>
                `;
                console.error('Error:', error);
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
